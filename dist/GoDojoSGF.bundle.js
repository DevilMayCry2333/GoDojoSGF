!function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(s,h,function(i){return t[i]}.bind(null,h));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";e.r(i),e.d(i,"SGF",(function(){return s}));const s=function(t){this.encoding="utf-8",this.boardSize="19",this.application="GoDojoSGF:1.0.0",this.fileFormat=1,this.gameMode=1,this.board=null,this.runtime={currentStep:0,board:[],branchMark:[],data:[],killBy:{}};const i=t.replace(/\n/g,"");if(this.symbolMap=this._scan(i),this.data=[],this.unsave={},this.symbolMap&&"("==i[0]){let t=this._parse(i,0,this.symbolMap[0]);this._parseRoot(t[0]),this.data=this._convert(t.slice(1)),this.runtime.history=[],this.runtime.step=-1,this.runtime.branch=this.data;for(let t=0;t<this.width;t++){const t=[];for(let i=0;i<this.height;i++)t.push("");this.runtime.board.push(t)}}};s.prototype.default=function(){if(this.board){let t=this.data,i=0,e=this.data.length;for(;i<e;)t[i]instanceof Array?(e=t[i].length,t=t[i],i=0):(this.putChess(t[i]),i++)}},s.prototype.putChess=function(t){""!==this.runtime.board[t.x][t.y]||this._isAsphyxiating(t.x,t.y,t.color.toLowerCase())||("w"==t.color?(this.board.putWhite(t.x,t.y),this.runtime.board[t.x][t.y]="w",this.board.select("b")):(this.board.putBlack(t.x,t.y),this.runtime.board[t.x][t.y]="b",this.board.select("b")),this.runtime.data.push(t))},s.prototype._unsave=function(t){this.unsave[`${t.x}:${t.y}:${t.color}`]=t},s.prototype.save=function(){if(Object.keys(this.unsave)){for(let t in this.unsave)this.unsave[t].status="saved";this.unsave={}}},s.prototype.insert=function(t,i,e){const s={color:e.toUpperCase(),x:t,y:i,status:"new"};this._unsave(s),this.runtime.data.push(s);const h=++this.runtime.step;if(h<this.runtime.branch.length){const t=this.runtime.branch[h];if(t instanceof Array){const t=this.runtime.branch;let i=!1;for(let e=h;e<t.length;e++){const n=t[e][0];n.x==s.x&&n.y==s.y&&n.color==s.color&&(i=!0,this._nextBranch(h,e))}i||(this.runtime.branch.push([s]),this._nextBranch(h,this.runtime.branch.length-1)),this._clearBranchMark()}else if(t.x!=s.x||t.y!=s.y||t.color!=s.color){const t=this.runtime.branch.splice(h);this.runtime.branch.push(t),this.runtime.branch.push([s]),this._nextBranch(h,this.runtime.branch.length-1)}this._checkBranch(this.runtime.step)}else this.runtime.branch.push(s)},s.prototype._clearBranchMark=function(){this.runtime.branchMark.forEach(t=>this.board.delete(t.x,t.y)),this.runtime.branchMark=[]},s.prototype._nextBranch=function(t,i){this.runtime.history.push({branch:this.runtime.branch,step:t-1}),this.runtime.branch=this.runtime.branch[i],this.runtime.step=0},s.prototype.continue=function(){const t=++this.runtime.step;if(t<this.runtime.branch.length){const i=this.runtime.branch[t];i instanceof Array?this.runtime.step--:(this.runtime.currentStep++,this.putChess(i),this._checkBranch(t))}else this.runtime.step--},s.prototype.back=function(){const t=this.runtime.step;if(t>-1){const i=this.runtime.branch[t];"w"==this.runtime.board[i.x][i.y]?this.board.select("w"):this.board.select("b"),this.runtime.board[i.x][i.y]="",this.board.delete(i.x,i.y),this._backLife(),this.runtime.step--,this.runtime.currentStep--,this.runtime.data.pop(),this._clearBranchMark()}if(-1==this.runtime.step){const t=this.runtime.history.pop();t&&(this.runtime.branch=t.branch,this.runtime.step=t.step,this._checkBranch(this.runtime.step))}},s.prototype._checkBranch=function(t){const i=this.runtime.branch;if(t+1<i.length&&i[t+1]instanceof Array)for(let e=t+1,s=0;e<i.length;e++,s++)this.board.putBranch(i[e][0].x,i[e][0].y,s),this.runtime.branchMark.push({x:i[e][0].x,y:i[e][0].y})},s.prototype.showOn=function(t){const i=document.getElementById(t);this.board=new h(i,{width:this.width,height:this.height}),this.board.setOnClickListener(this._click.bind(this)),this.board.setOnRClickListener(this._rclick.bind(this))},s.prototype._rclick=function(){if(step>-1){const t=this.runtime.branch[this.runtime.step];"new"==t.status&&this._delete(t)}},s.prototype._delete=function(t){},s.prototype._click=function(t,i,e){if("b"==e||"w"==e)return""===this.runtime.board[t][i]&&!this._isAsphyxiating(t,i,e)&&(this.runtime.board[t][i]=e,this.runtime.currentStep++,this.insert(t,i,e),setTimeout(()=>{"b"==e?this.board.select("w"):this.board.select("b")},10),!0)},s.prototype._backLife=function(){const t=this.runtime.killBy[this.runtime.currentStep];t&&(t.forEach(t=>this.putChess(t)),this.runtime.killBy[this.runtime.currentStep]=void 0)},s.prototype._isAsphyxiating=function(t,i,e){this.runtime.board[t][i]=e,this._clearDead(t,i,e);const s=!this._searchBreath(t,i);return this.runtime.board[t][i]="",s},s.prototype._clearDead=function(t,i,e){const s=[0,1,0,-1],h=[1,0,-1,0];for(let n=0;n<4;n++){const r=t+s[n],o=i+h[n];if(r>=0&&r<this.width&&o>=0&&o<this.height&&this.runtime.board[r][o]!=e&&""!==this.runtime.board[r][o]){const t=[];if(!this._searchBreath(r,o,t)){this.runtime.killBy[this.runtime.currentStep+1]=[];for(let i=0;i<t.length;i++)this.runtime.killBy[this.runtime.currentStep+1].push({x:t[i].x,y:t[i].y,color:this.runtime.board[t[i].x][t[i].y].toUpperCase()}),this.runtime.board[t[i].x][t[i].y]="",this.board.delete(t[i].x,t[i].y)}}}},s.prototype._searchBreath=function(t,i,e=[]){const s=[0,1,0,-1],h=[1,0,-1,0],n=[],r={},o=this.runtime.board[t][i];for(n.push({x:t,y:i}),r[`${t}:${i}`]=!0,e.push({x:t,y:i});n.length>0;){const t=n.splice(0,1)[0];for(let i=0;i<4;i++){const a=t.x+s[i],c=t.y+h[i];if(!r[`${a}:${c}`]&&a>=0&&a<this.width&&c>=0&&c<this.height){r[`${a}:${c}`]=!0;const t=this.runtime.board[a][c];if(t==o)n.push({x:a,y:c}),e.push({x:a,y:c});else if(""==t)return!0}}}return!1},s.prototype._convert=function(t){const i=[],e="a".charCodeAt();for(let s=0;s<t.length;s++)if("object"==typeof t[s])i.push(this._convert(t[s]));else{const h=/(W|B)\[(\w)(\w)\]/.exec(t[s]);h&&i.push({color:h[1].toLocaleLowerCase(),x:h[2].charCodeAt()-e,y:h[3].charCodeAt()-e,status:"saved"})}return i},s.prototype._parse=function(t,i,e){const s=[];let h=i+1,n=t.indexOf("(",h);for((n>e||-1==n)&&(n=e),t.substring(h,n).split(";").forEach(t=>{t.length>0&&s.push(t)}),h=n;h<e&&-1!=h;){let i=this.symbolMap[h];s.push(this._parse(t,h,i)),h=t.indexOf("(",i)}return s},s.prototype._scan=function(t){const i={},e=[];let s=0;for(let h=0;h<t.length;h++)switch(t[h]){case"(":e[s++]=h;break;case")":i[e[--s]]=h}return s?null:i},s.prototype._parseRoot=function(t){if((AP=/AP\[(.*?)\]/.exec(t))&&(this.application=AP[1]),(CA=/CA\[(.*?)\]/.exec(t))&&(this.encoding=CA[1]),(GM=/GM\[(\d+)\]/.exec(t))&&(this.gameMode=parseInt(GM[1])),(FF=/FF\[([1-4])\]/.exec(t))&&(this.fileFormat=parseInt(FF[1])),SZ=/SZ\[(\d+|\d+:\d+)\]/.exec(t))if(this.boardSize=SZ[1],this.width=0,this.height=0,this.boardSize.indexOf(":")>-1){const t=this.boardSize.split(":");this.width=t[0],this.height=t[1]}else this.width=this.height=parseInt(this.boardSize)};const h=function(t,i={}){this.width=i.width||19,this.height=i.height||19,this.lineColor=i.lineColor||"black",this.background=i.background||"#fff",this.margin=i.margin||20,this.padding=i.padding||30,this.branchColor=i.branchColor||"blue",this.workspace=document.createElement("div"),this.board=document.createElement("canvas"),this.chessLayer=document.createElement("canvas"),this.promptLayer=document.createElement("canvas"),this.workspace.appendChild(this.board),this.workspace.appendChild(this.chessLayer),this.workspace.appendChild(this.promptLayer),this.runtime={select:"b",onClickListeners:[],onRClickListeners:[]},this._build(),this._bind(),t.appendChild&&t.appendChild(this.workspace)};h.prototype._bind=function(){this.workspace.onclick=this._onclick.bind(this),this.workspace.oncontextmenu=function(t){t.preventDefault();const i=this._clickLoc(t);this.runtime.onRClickListeners.forEach(t=>t(i.x,i.y))}.bind(this),this.promptX=-1,this.promptY=-1,this.workspace.onmousemove=function(t){const i=this._clickLoc(t);i.x==this.promptX&&i.y==this.promptY||(-1!=this.promptX&&-1!=this.promptY&&this.delete(this.promptX,this.promptY,!0),this.promptX=i.x,this.promptY=i.y,-1!=this.promptX&&-1!=this.promptY&&this._drawObject(this.promptX,this.promptY,this.runtime.select,!0))}.bind(this),this.workspace.onmouseleave=function(t){-1!=this.promptX&&-1!=this.promptY&&this.delete(this.promptX,this.promptY,!0)}.bind(this)},h.prototype._onclick=function(t){const i=this._clickLoc(t);for(let t=0;t<this.runtime.onClickListeners.length;t++){if(!(0,this.runtime.onClickListeners[t])(i.x,i.y,this.runtime.select))return}this._drawObject(i.x,i.y,this.runtime.select)},h.prototype._clickLoc=function(t){const i=t.offsetX-this.margin,e=t.offsetY-this.margin,s=this.padding/2;let h=0,n=0;return{x:h=i<0&&i>-1*s?0:i>this.boardWidth&&this.boardWidth+s?this.width-1:parseInt((i+s)/(this.padding+1)),y:n=e<0&&e>-1*s?0:e>this.boardHeight&&this.boardHeight+s?this.height-1:parseInt((e+s)/(this.padding+1))}},h.prototype._buildLayerStyle=function(t,i){this.board.width=t,this.board.height=i,this.board.style.position="absolute",this.chessLayer.width=t,this.chessLayer.height=i,this.chessLayer.style.position="absolute",this.promptLayer.width=t,this.promptLayer.height=i,this.promptLayer.style.position="absolute",this.workspace.style.position="relative",this.workspace.style.width=t+"px",this.workspace.style.height=i+"px",this.workspace.style.margin="0",this.workspace.style.padding="0"},h.prototype._build=function(){this.node=this._getNodes(),this.boardWidth=(this.width-1)*this.padding+this.width,this.visableWidth=this.boardWidth+2*this.margin,this.boardHeight=(this.height-1)*this.padding+this.height,this.visableHeight=this.boardHeight+2*this.margin,this._buildLayerStyle(this.visableWidth,this.visableHeight);const t=this.board.getContext("2d");t.strokeStyle=this.lineColor;for(let i=0,e=this.margin,s=this.margin;i<this.width;i++)t.beginPath(),t.moveTo(e,s),t.lineTo(e,s+this.boardHeight),t.closePath(),t.stroke(),e+=this.padding+1;for(let i=0,e=this.margin,s=this.margin;i<this.width;i++)t.beginPath(),t.moveTo(e,s),t.lineTo(e+this.boardWidth,s),t.closePath(),t.stroke(),s+=this.padding+1;let i=[],e=[];this.width>6&&this.width<10?i=[2,this.width-3]:this.width>9&&this.width<15||!(this.width%2)?i=[3,this.width-4]:this.width>14&&(i=[3,parseInt(this.width/2),this.width-4]),this.height>6&&this.height<10?e=[2,this.height-3]:this.height>9&&this.height<15||!(this.height%2)?e=[3,this.height-4]:this.height>14&&(e=[3,parseInt(this.height/2),this.height-4]),t.fillStyle=this.lineColor;for(let s=0;s<i.length;s++)for(let h=0;h<e.length;h++)this._drawStar(t,this.node.get(i[s],e[h]));13==this.width&&13==this.height&&this._drawStar(t,this.node.get(6,6))},h.prototype._drawStar=function(t,i){t.beginPath(),t.arc(i.x,i.y,3.5,0,2*Math.PI),t.closePath(),t.fill()},h.prototype._drawObject=function(t,i,e,s=!1){const h=s?this.promptLayer.getContext("2d"):this.chessLayer.getContext("2d"),n=this.node.get(t,i);"w"==e?(h.fillStyle=s?"#ffffffdd":"#fff",h.strokeStyle=this.lineColor,h.lineWidth=1.5,h.beginPath(),h.arc(n.x,n.y,this.padding/2-1,0,2*Math.PI),h.closePath(),h.fill(),h.stroke()):"b"==e?(h.fillStyle=s?"#00000055":"#000",h.strokeStyle=this.lineColor,h.lineWidth=1.5,h.beginPath(),h.arc(n.x,n.y,this.padding/2-1,0,2*Math.PI),h.closePath(),h.fill(),h.stroke()):e>="A"&&e<="Z"&&(h.fillStyle="#fff",h.beginPath(),h.arc(n.x,n.y,this.padding/3,0,2*Math.PI),h.closePath(),h.fill(),h.font=`${parseInt(this.padding/2)-1}px bold 黑体`,h.textAlign="center",h.textBaseline="middle",h.fillStyle=this.branchColor,h.fillText(e,n.x,n.y,this.padding-2))},h.prototype.putWhite=function(t,i){this._drawObject(t,i,"w")},h.prototype.putBlack=function(t,i){this._drawObject(t,i,"b")},h.prototype.putBranch=function(t,i,e){const s="A".charCodeAt()+e;this._drawObject(t,i,String.fromCharCode(s))},h.prototype.delete=function(t,i,e=!1){const s=e?this.promptLayer.getContext("2d"):this.chessLayer.getContext("2d"),h=this.node.get(t,i),n=this.padding/2;s.clearRect(h.x-n,h.y-n,this.padding,this.padding)},h.prototype.setOnClickListener=function(t){this.runtime.onClickListeners.indexOf(t)<0&&this.runtime.onClickListeners.push(t)},h.prototype.removeOnClickListener=function(t){const i=this.runtime.onClickListeners.indexOf(t);i>-1&&this.runtime.onClickListeners.splice(i,1)},h.prototype.setOnRClickListener=function(t){this.runtime.onRClickListeners.indexOf(t)<0&&this.runtime.onRClickListeners.push(t)},h.prototype.removeOnRClickListener=function(t){const i=this.runtime.onRClickListeners.indexOf(t);i>-1&&this.runtime.onRClickListeners.splice(i,1)},h.prototype.select=function(t){this.runtime.select=t},h.prototype._getNodes=function(){const t=[];for(let i=0,e=this.margin;i<this.width;i++){const i=[];for(let t=0,s=this.margin;t<this.height;t++)i.push({x:e,y:s}),s+=this.padding+1;e+=this.padding+1,t.push(i)}return t.get=function(t,i){return t>=this.length||i>=this[t].length?{x:-1,y:-1}:this[t][i]},t}}]);